set $scripts "$HOME/.config/sway/scripts"

# Key bindings {{{
set $mod  Mod4
set $modr Mod5
set $left  h
set $down  j
set $up    k
set $right l

# bindsym --to-code {
# 	$mod+Return exec alacritty
# 	$mod+Shift+Return exec alacritty \
# 		--working-directory $(cat /tmp/last_pwd 2>/dev/null || echo $HOME)
# 	$mod+f2 exec alacritty \
# 		--working-directory $HOME/.config/sway \
# 		--command $SHELL -ic "nvim config"
# }

bindsym --to-code {
	$mod+Return exec foot
	$modr+Return exec foot
	$mod+Shift+Return exec foot --working-directory $(cat /tmp/last_pwd 2>/dev/null || echo $HOME)
	$modr+Shift+Return exec foot --working-directory $(cat /tmp/last_pwd 2>/dev/null || echo $HOME)
	$mod+f2 exec foot $SHELL -i -c "cd $HOME/.config/sway && nvim config"

	$mod+Control+Shift+f exec nautilus --new-window
	$mod+Control+Shift+b exec firefox

	# Unsetting XDG_CURRENT_DESKTOP, because `rofi` hides some entries,
	# based on this variable
	$mod+p exec env -u XDG_CURRENT_DESKTOP \
		rofi -i -show drun -run-command 'swaymsg exec "{cmd}"', \
		input type:keyboard xkb_switch_layout 0

	$mod+$left   focus left
	$mod+$down   focus down
	$mod+$up     focus up
	$mod+$right  focus right

	$mod+Control+h nop tab prev
	$mod+Control+l nop tab next
	$mod+Control+1 nop tab 1
	$mod+Control+2 nop tab 2
	$mod+Control+3 nop tab 3
	$mod+Control+4 nop tab 4
	$mod+Control+5 nop tab 5
	$mod+Control+6 nop tab 6
	$mod+Control+7 nop tab 7
	$mod+Control+8 nop tab 8
	$modr+Control+h nop tab prev
	$modr+Control+l nop tab next
	$modr+Control+1 nop tab 1
	$modr+Control+2 nop tab 2
	$modr+Control+3 nop tab 3
	$modr+Control+4 nop tab 4
	$modr+Control+5 nop tab 5
	$modr+Control+6 nop tab 6
	$modr+Control+7 nop tab 7
	$modr+Control+8 nop tab 8

	$mod+Shift+$left  move left
	$mod+Shift+$down  move down
	$mod+Shift+$up    move up
	$mod+Shift+$right move right

	$mod+Bracketleft  workspace prev
	$mod+Bracketright workspace next
	$modr+Bracketleft  workspace prev
	$modr+Bracketright workspace next

	$mod+Shift+Bracketleft  nop workspace prev
	$mod+Shift+Bracketright nop workspace next

	# TODO: rewrite using lua framework
	$mod+Control+Up    exec $scripts/push-window.sh top
	$mod+Control+Right exec $scripts/push-window.sh right
	$mod+Control+Down  exec $scripts/push-window.sh bottom
	$mod+Control+Left  exec $scripts/push-window.sh left

	$mod+s layout stacking
	$mod+w layout tabbed
	$mod+e layout toggle split

	$mod+Shift+q kill
	$mod+Shift+c reload
	$mod+c move position center
	$mod+b splith
	$mod+v splitv
	$mod+f fullscreen
	$mod+Shift+f floating toggle
	$mod+Control+Shift+p focus parent
	$mod+Control+Shift+c focus child
	$mod+Shift+a focus mode_toggle
}

# Mouse movement keyboard control:
set $cursor_lg_delta 50
set $cursor_sm_delta 10
bindsym --to-code {
	$mod+Control+Alt+Up    seat * cursor move 0 -$cursor_lg_delta
	$mod+Control+Alt+Right seat * cursor move $cursor_lg_delta  0
	$mod+Control+Alt+Down  seat * cursor move 0  $cursor_lg_delta
	$mod+Control+Alt+Left  seat * cursor move -$cursor_lg_delta 0

	$mod+Alt+Up            seat * cursor move 0 -$cursor_sm_delta
	$mod+Alt+Right         seat * cursor move $cursor_sm_delta  0
	$mod+Alt+Down          seat * cursor move 0  $cursor_sm_delta
	$mod+Alt+Left          seat * cursor move -$cursor_sm_delta 0

	# Mouse button control (doesn't work well though):
	--no-repeat $mod+Alt+Period seat * cursor press   button1
	--release   $mod+Alt+Period seat * cursor release button1
	--no-repeat $mod+Alt+Slash  seat * cursor press   button3
	--release   $mod+Alt+Slash  seat * cursor release button3

	$mod+1 workspace number 1
	$mod+2 workspace number 2
	$mod+3 workspace number 3
	$mod+4 workspace number 4
	$mod+5 workspace number 5
	$mod+6 workspace number 6
	$mod+7 workspace number 7
	$mod+8 workspace number 8
	$mod+9 workspace number 9
	$mod+0 workspace number 10

	$modr+1 workspace number 1
	$modr+2 workspace number 2
	$modr+3 workspace number 3
	$modr+4 workspace number 4
	$modr+5 workspace number 5
	$modr+6 workspace number 6
	$modr+7 workspace number 7
	$modr+8 workspace number 8
	$modr+9 workspace number 9
	$modr+0 workspace number 10

	$mod+Tab nop focus_prev

	$mod+Shift+1 move container to workspace number 1
	$mod+Shift+2 move container to workspace number 2
	$mod+Shift+3 move container to workspace number 3
	$mod+Shift+4 move container to workspace number 4
	$mod+Shift+5 move container to workspace number 5
	$mod+Shift+6 move container to workspace number 6
	$mod+Shift+7 move container to workspace number 7
	$mod+Shift+8 move container to workspace number 8
	$mod+Shift+9 move container to workspace number 9
	$mod+Shift+0 move container to workspace number 10

	$modr+Shift+1 move container to workspace number 1
	$modr+Shift+2 move container to workspace number 2
	$modr+Shift+3 move container to workspace number 3
	$modr+Shift+4 move container to workspace number 4
	$modr+Shift+5 move container to workspace number 5
	$modr+Shift+6 move container to workspace number 6
	$modr+Shift+7 move container to workspace number 7
	$modr+Shift+8 move container to workspace number 8
	$modr+Shift+9 move container to workspace number 9
	$modr+Shift+0 move container to workspace number 10

	$mod+Shift+minus move scratchpad
	$mod+minus scratchpad show
}

bindsym {
	$mod+i exec $scripts/rofi-window-switch.sh
	$mod+o exec $scripts/rename-workspace.sh

	$mod+Shift+e exec swaynag \
		--type warning \
		--message "You pressed the exit shortcut. Do you really want to exit sway? This will end your Wayland session." \
		--button "Yes, exit sway" "swaymsg exit" \
		--no-dock
}

# Various multimedia keys
bindsym {
	XF86AudioRaiseVolume  exec $scripts/volume-control.sh up
	XF86AudioLowerVolume  exec $scripts/volume-control.sh down
	XF86AudioMute         exec $scripts/volume-control.sh toggle
	Control+XF86AudioMute exec $scripts/volume-control.sh toggle-mic

	--to-code --no-repeat $mod+m exec $scripts/volume-control.sh unmute-down
	--to-code --release   $mod+m exec $scripts/volume-control.sh unmute-up

	XF86MonBrightnessDown exec $scripts/backlight-control.sh down
	XF86MonBrightnessUp   exec $scripts/backlight-control.sh up

	XF86AudioPlay exec playerctl play-pause
	XF86AudioNext exec playerctl next
	XF86AudioPrev exec playerctl previous

	Print         exec grimvshot --notify --swaynag --area
	Shift+Print   exec grimvshot --notify --swaynag --window
	Control+Print exec grimvshot --notify --swaynag --screen

	XF86PowerOff exec $scripts/suspend.sh
}

bindsym --to-code $mod+r mode "resize"
mode "resize" {
	bindsym $left  resize shrink width  20px
	bindsym $down  resize grow   height 20px
	bindsym $up    resize shrink height 20px
	bindsym $right resize grow   width  20px
	bindsym Return mode default
	bindsym Escape mode default
}

bindsym --to-code $mod+f12 mode "nested sway"
mode "nested sway" {
	bindsym $mod+f12 mode default
}

bindsym --to-code $mod+Shift+w mode "move workspace"
mode "move workspace" {
	bindsym --to-code $left  move workspace to output left,  mode default
	bindsym --to-code $right move workspace to output right, mode default
	bindsym Escape mode default
}

bindsym --to-code $mod+Shift+b mode "set window border"
mode "set window border" {
	bindsym --to-code n border normal, mode default
	bindsym --to-code p border pixel, mode default
	bindsym Escape mode default
}

bindsym --to-code $mod+Shift+o mode "manage output"
mode "manage output" {
	# bindsym --to-code t nop output toggle, mode default
	# bindsym --to-code a nop output enable_all, mode default
	bindsym --to-code t output - toggle, mode default
	bindsym --to-code a output * enable, mode default
	bindsym --to-code r output * disable, output * enable, mode default
	bindsym Escape mode default
}

# }}}

# Theme and colors {{{

# Default colors from sway(5)
# class              border      background  text        indicator   child_border
# focused            #4c7899     #285577     #ffffff     #2e9ef4     #285577
# focused_inactive   #333333     #5f676a     #ffffff     #484e50     #5f676a
# focused_tab_title  #333333     #5f676a     #ffffff     n/a         n/a    
# unfocused          #333333     #222222     #888888     #292d2e     #222222
# urgent             #2f343a     #900000     #ffffff     #900000     #900000
# placeholder        #000000     #0c0c0c     #ffffff     #000000     #0c0c0c

# Same as above, but via variables
# set {
# 	$focused_title_border #4c7899
# 	$focused_title_bg #285577
# 	$focused_title_text #ffffff
# 	$focused_indicator #2e9ef4
# 	$focused_border #285577

# 	$unfocused_title_border #333333
# 	$unfocused_title_bg #222222
# 	$unfocused_title_text #888888
# 	$unfocused_indicator #292d2e
# 	$unfocused_border #222222

# 	$urgent_title_border #2f343a
# 	$urgent_title_bg #900000
# 	$urgent_title_text #ffffff
# 	$urgent_indicator #900000
# 	$urgent_border #900000
# }

# Same as above, but via variables
set {
	$focused_title_border #4c7899
	$focused_title_bg #285577
	$focused_title_text #ffffff
	$focused_indicator #2e9ef4
	$focused_border #285577

	$unfocused_title_border #444444
	$unfocused_title_bg #222222
	$unfocused_title_text #888888
	$unfocused_indicator #666666
	$unfocused_border #444444

	$urgent_title_border #2f343a
	$urgent_title_bg #900000
	$urgent_title_text #ffffff
	$urgent_indicator #900000
	$urgent_border #900000
}

# set {
# 	$focused_title_border "#ee6600"
# 	$focused_title_bg "#884400"
# 	$focused_title_text "#ffffff"
# 	$focused_indicator "#ff0044"
# 	$focused_border $focused_title_border
# 	$unfocused_title_border "#333333"
# 	$unfocused_title_bg "#222222"
# 	$unfocused_title_text "#bbbbbb"
# 	$unfocused_indicator "#882200"
# 	$unfocused_border $unfocused_title_border
# 	$urgent_title_border "#bb0000"
# 	$urgent_title_bg "#880000"
# 	$urgent_title_text "#ffffff"
# 	$urgent_indicator "#dd0000"
# 	$urgent_border $urgent_title_border
# }

# Set colors from theme variables
client.focused           $focused_title_border   $focused_title_bg   $focused_title_text   $focused_indicator   $focused_border
client.focused_inactive  $unfocused_title_border $unfocused_title_bg $unfocused_title_text $unfocused_indicator $unfocused_border
client.focused_tab_title $focused_title_border   $focused_title_bg   $focused_title_text
client.unfocused         $unfocused_title_border $unfocused_title_bg $unfocused_title_text $unfocused_indicator $unfocused_border
client.urgent            $urgent_title_border    $urgent_title_bg    $urgent_title_text    $urgent_indicator    $urgent_border

# client.focused_inactive  "#ff8800" "#884400" "#ffffff" "#ff4400" "#ff8800"
# client.focused           "#ff8800" "#884400" "#ffffff" "#ff4400" "#ff8800"
# client.focused_inactive  "#666666" "#222222" "#ffffff" "#444444" "#666666"
# client.unfocused         "#666666" "#222222" "#ffffff" "#444444" "#666666"
# client.focused_tab_title "#ff8800" "#884400" "#ffffff" "#ff4400" "#ff8800"

# client.unfocused         "#444444" "#222222" "#aaaaaa" "#292d2e" "#444444"
# client.focused_inactive  "#444444" "#222222" "#aaaaaa" "#292d2e" "#444444"
# client.focused_tab_title "#4c7899" "#285577" "#ffffff"
# }}}

# Bar {{{

# bar {
# 	swaybar_command waybar
# }

bar {
	status_command gost
	font Monospace 11
	height 0
	position bottom
	icon_theme "Papirus"
	separator_symbol "|"
	# disable tray until DBus will be implemented
	tray_output none
	wrap_scroll yes
	workspace_min_width 24
	colors {
		separator "#bbbbbb"
		focused_workspace $focused_title_border $focused_title_bg $focused_title_text
		inactive_workspace $unfocused_title_border $unfocused_title_bg $unfocused_title_text
		urgent_workspace $urgent_title_border $urgent_title_bg $urgent_title_text
	}
}
# }}}

# Input configuration {{{
input type:pointer {
	accel_profile flat
}

# input type:keyboard { # Crashes firefox on sway reload

input type:keyboard {
	xkb_layout "us(altgr-intl),ua"
	xkb_options "grp:win_space_toggle,caps:escape_shifted_capslock"
	repeat_delay 300
	repeat_rate 25
}

# input "1:1:AT_Translated_Set_2_keyboard" {
# 	xkb_layout "us(altgr-intl),ua"
# 	xkb_options "grp:win_space_toggle,caps:escape_shifted_capslock"
# 	repeat_delay 300
# 	repeat_rate 25
# }

# input "1452:591:Keychron_Keychron_K3" {
# 	xkb_layout "us(altgr-intl),ua"
# 	xkb_options "grp:win_space_toggle,caps:escape_shifted_capslock"
# 	repeat_delay 300
# 	repeat_rate 25
# }

# input "1452:591:Keychron_K3" {
# 	xkb_layout "us(altgr-intl),ua"
# 	xkb_options "grp:win_space_toggle,caps:escape_shifted_capslock"
# 	repeat_delay 300
# 	repeat_rate 25
# }

input type:touchpad {
	tap enabled
	natural_scroll enabled
	click_method clickfinger
	dwt enabled
}

# }}}

# Various options {{{
set $border_width 2
smart_gaps on
# gaps inner 6
# gaps outer 0
floating_modifier $mod
smart_borders no_gaps
default_border normal $border_width
default_floating_border normal $border_width
titlebar_padding 8 1
focus_wrapping workspace
focus_follows_mouse no
font Monospace Bold 10

# kraftwerk28's patch only:
mouse_resizing_mode eight_direction

# }}}

# Cursor {{{
# Path int /usr/share/icons
set $cursor_theme "xcursor-breeze-snow"
set $cursor_size 24
seat * xcursor_theme $cursor_theme $cursor_size
exec_always {
	gsettings set org.gnome.desktop.interface cursor-theme $cursor_theme
	gsettings set org.gnome.desktop.interface cursor-size $cursor_size
	sed -i -r 's/^Inherits=.+/Inherits='$cursor_theme'/' ~/.icons/default/index.theme
}
# }}}

# Autostart {{{
exec $scripts/enhance.lua
# exec {
# 	blueman-applet
# 	kdeconnect-indicator
# }
exec [ "$NO_AUTOSTART" != 1 ] && swaymsg \
	"workspace 5, layout tabbed," \
	"exec telegram-desktop, exec foot weechat, exec thunderbird"
exec /usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1
exec $scripts/swayidle.sh
# }}}

# Window rules {{{
for_window [app_id="firefox" title="^Picture-in-Picture$"] floating enable, sticky enable, border pixel
for_window [app_id="firefox" title="Sharing Indicator$"] floating enable, resize set 0 0, sticky enable
for_window [app_id="firefox" title="^Developer Tools"] floating enable

for_window [app_id="pavucontrol"] floating enable
for_window [app_id="blueman-manager"] floating enable
for_window [title="QjackCtl"] floating enable
for_window [title="xeyes"] floating enable, border normal $border_width, sticky enable
for_window [floating app_id="^Alacritty$"] border pixel $border_width
for_window [title="^Blender Preferences$"] floating enable
for_window [title="^Welcome to IntelliJ IDEA$"] floating enable
for_window [app_id="^foot_floating$"] floating enable
for_window [app_id="^gnome-calculator$"] floating enable
for_window [app_id="^org.gnome.Calculator$"] floating enable
for_window [title="^FX: Track"] floating enable
# }}}

# Output configuration {{{
set $laptop eDP-1
set $external_usb DP-1
set $external_hdmi DP-3

# bindswitch lid:on  output $laptop disable
# bindswitch lid:off output $laptop enable
# output $laptop scale 1.2
# output $laptop scale 1
# output $laptop   position 0    1700
# output $external position 1600 0
# output $external transform 90
# output $laptop position 0 

# If external monitor is on the right
# output $laptop position 0 360
# output $external_usb position 1920 0
# output $external_hdmi position 1920 0

# If external monitor is on the left
output $laptop position 2560 360
output $external_usb position 0 0
output $external_hdmi position 0 0

# output $laptop   background "#000000" solid_color
# output $external background "#000000" solid_color
# }}}

# Wallpapers {{{
# output $laptop   background      /usr/share/backgrounds/sway/Sway_Wallpaper_Blue_1920x1080.png fill
# output $external_hdmi background /usr/share/backgrounds/sway/Sway_Wallpaper_Blue_2048x1536.png fill
# output $external_usb  background /usr/share/backgrounds/sway/Sway_Wallpaper_Blue_2048x1536.png fill
output * background #000000 solid_color
# }}}

exec_always "systemctl --user import-environment; systemctl --user start sway-session.target"

# vim: filetype= commentstring=#\ %s foldmethod=marker foldlevel=0
